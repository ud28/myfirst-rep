/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.viz.ui5.data.FlattenedDataset");jQuery.sap.require("sap.viz.library");jQuery.sap.require("sap.viz.ui5.data.Dataset");sap.viz.ui5.data.Dataset.extend("sap.viz.ui5.data.FlattenedDataset",{metadata:{library:"sap.viz",aggregations:{"dimensions":{type:"sap.viz.ui5.data.DimensionDefinition",multiple:true,singularName:"dimension"},"measures":{type:"sap.viz.ui5.data.MeasureDefinition",multiple:true,singularName:"measure"},"data":{type:"sap.ui.core.Element",multiple:true,singularName:"data",bindable:"bindable"}}}});
sap.viz.ui5.data.FlattenedDataset.prototype.init=function(){};
sap.viz.ui5.data.FlattenedDataset.prototype.bindAggregation=function(n,b){if(n==="data"){if(typeof b=="string"){b={path:arguments[1],template:arguments[2],sorter:arguments[3],filters:arguments[4]};if(b.template instanceof sap.ui.model.Sorter||jQuery.isArray(b.sorter)&&b.sorter.length>0&&b.sorter[0]instanceof sap.ui.model.Filter){b.filters=b.sorter;b.sorter=b.template}}b.template=undefined;b.factory=function(){};return sap.ui.core.Element.prototype.bindAggregation.call(this,n,b)}return sap.ui.core.Element.prototype.bindAggregation.apply(this,arguments)};
sap.viz.ui5.data.FlattenedDataset.prototype.updateData=function(){var b=this.getBinding("data"),c=b&&b.getContexts(0,b.getLength());if(!c||c.length===0){delete this._oVIZCrosstab;return}var a=[],A=[],m=[],d=[];jQuery.each(this.getDimensions(),function(i,C){if(C.getAxis()===1){a.push(C)}else if(C.getAxis()===2){A.push(C)}else{throw new Error();m.push(C);d.push([])}});jQuery.each(this.getMeasures(),function(i,C){m.push(C);d.push([])});function g(C,n){if(n.length===0)return null;var r=[];for(var i=0;i<n.length;i++){r.push(C.getProperty(n[i].getBindingInfo("value").path))}return r}function f(D,o){if(!o){return 0}for(var i=0;i<D.length;i++){if(jQuery.sap.equal(D[i],o)){return i}}D.push(o);return D.length-1}var e=[];var h=[];jQuery.each(c,function(I,C){var n=f(e,g(C,a));var o=f(h,g(C,A));for(var i=0;i<m.length;i++){var p=C.getProperty(m[i].getBindingInfo("value").path);(d[i][o]=(d[i][o]||[]))[n]=p}});var k={analysisAxis:[],measureValuesGroup:[]};if(a.length>0){var l={index:1,data:[]};for(var i=0;i<a.length;i++){var v=[];for(var j=0;j<e.length;j++){v[j]=e[j][i]}l.data.push({name:a[i].getName(),values:v})}k.analysisAxis.push(l)}if(A.length>0){var l={index:2,data:[]};for(var i=0;i<A.length;i++){var v=[];for(var j=0;j<h.length;j++){v[j]=h[j][i]}l.data.push({name:A[i].getName(),values:v})}k.analysisAxis.push(l)}for(var i=0;i<m.length;i++){if(!k.measureValuesGroup[m[i].getGroup()-1]){k.measureValuesGroup[m[i].getGroup()-1]={index:m[i].getGroup(),data:[]}}k.measureValuesGroup[m[i].getGroup()-1].data.push({name:m[i].getName(),values:d[i]})}this._oVIZCrosstab=new sap.viz.data.CrosstableDataset();this._oVIZCrosstab.setData(k);this.invalidate()};
sap.viz.ui5.data.FlattenedDataset.prototype.getVIZDataset=function(){return this._oVIZCrosstab||null};
