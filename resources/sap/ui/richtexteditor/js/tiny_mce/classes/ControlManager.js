/**
 * ControlManager.js
 *
 * Copyright, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */
(function(a){var D=a.DOM,E=a.dom.Event,e=a.each,b=a.extend;a.create('tinymce.ControlManager',{ControlManager:function(d,s){var t=this,i;s=s||{};t.editor=d;t.controls={};t.onAdd=new a.util.Dispatcher(t);t.onPostRender=new a.util.Dispatcher(t);t.prefix=s.prefix||d.id+'_';t._cls={};t.onPostRender.add(function(){e(t.controls,function(c){c.postRender()})})},get:function(i){return this.controls[this.prefix+i]||this.controls[i]},setActive:function(i,s){var c=null;if(c=this.get(i))c.setActive(s);return c},setDisabled:function(i,s){var c=null;if(c=this.get(i))c.setDisabled(s);return c},add:function(c){var t=this;if(c){t.controls[c.id]=c;t.onAdd.dispatch(c,t)}return c},createControl:function(n){var c,i,l,s=this,d=s.editor,f,g;if(!s.controlFactories){s.controlFactories=[];e(d.plugins,function(p){if(p.createControl){s.controlFactories.push(p)}})}f=s.controlFactories;for(i=0,l=f.length;i<l;i++){c=f[i].createControl(n,s);if(c){return s.add(c)}}if(n==="|"||n==="separator"){return s.createSeparator()}if(d.buttons&&(c=d.buttons[n])){return s.createButton(n,c)}return s.add(c)},createDropMenu:function(i,s,d){var t=this,f=t.editor,c,g,v,h;s=b({'class':'mceDropDown',constrain:f.settings.constrain_menus},s);s['class']=s['class']+' '+f.getParam('skin')+'Skin';if(v=f.getParam('skin_variant'))s['class']+=' '+f.getParam('skin')+'Skin'+v.substring(0,1).toUpperCase()+v.substring(1);s['class']+=f.settings.directionality=="rtl"?' mceRtl':'';i=t.prefix+i;h=d||t._cls.dropmenu||a.ui.DropMenu;c=t.controls[i]=new h(i,s);c.onAddItem.add(function(c,o){var s=o.settings;s.title=f.getLang(s.title,s.title);if(!s.onclick){s.onclick=function(v){if(s.cmd)f.execCommand(s.cmd,s.ui||false,s.value)}}});f.onRemove.add(function(){c.destroy()});if(a.isIE){c.onShowMenu.add(function(){f.focus();g=f.selection.getBookmark(1)});c.onHideMenu.add(function(){if(g){f.selection.moveToBookmark(g);g=0}})}return t.add(c)},createListBox:function(i,s,d){var t=this,f=t.editor,g,c,h;if(t.get(i))return null;s.title=f.translate(s.title);s.scope=s.scope||f;if(!s.onselect){s.onselect=function(v){f.execCommand(s.cmd,s.ui||false,v||s.value)}}s=b({title:s.title,'class':'mce_'+i,scope:s.scope,control_manager:t},s);i=t.prefix+i;function u(f){return f.settings.use_accessible_selects&&!a.isGecko}if(f.settings.use_native_selects||u(f))c=new a.ui.NativeListBox(i,s);else{h=d||t._cls.listbox||a.ui.ListBox;c=new h(i,s,f)}t.controls[i]=c;if(a.isWebKit){c.onPostRender.add(function(c,n){E.add(n,'mousedown',function(){f.bookmark=f.selection.getBookmark(1)});E.add(n,'focus',function(){f.selection.moveToBookmark(f.bookmark);f.bookmark=null})})}if(c.hideMenu)f.onMouseDown.add(c.hideMenu,c);return t.add(c)},createButton:function(i,s,d){var t=this,f=t.editor,o,c,g;if(t.get(i))return null;s.title=f.translate(s.title);s.label=f.translate(s.label);s.scope=s.scope||f;if(!s.onclick&&!s.menu_button){s.onclick=function(){f.execCommand(s.cmd,s.ui||false,s.value)}}s=b({title:s.title,'class':'mce_'+i,unavailable_prefix:f.getLang('unavailable',''),scope:s.scope,control_manager:t},s);i=t.prefix+i;if(s.menu_button){g=d||t._cls.menubutton||a.ui.MenuButton;c=new g(i,s,f);f.onMouseDown.add(c.hideMenu,c)}else{g=t._cls.button||a.ui.Button;c=new g(i,s,f)}return t.add(c)},createMenuButton:function(i,s,c){s=s||{};s.menu_button=1;return this.createButton(i,s,c)},createSplitButton:function(i,s,d){var t=this,f=t.editor,g,c,h;if(t.get(i))return null;s.title=f.translate(s.title);s.scope=s.scope||f;if(!s.onclick){s.onclick=function(v){f.execCommand(s.cmd,s.ui||false,v||s.value)}}if(!s.onselect){s.onselect=function(v){f.execCommand(s.cmd,s.ui||false,v||s.value)}}s=b({title:s.title,'class':'mce_'+i,scope:s.scope,control_manager:t},s);i=t.prefix+i;h=d||t._cls.splitbutton||a.ui.SplitButton;c=t.add(new h(i,s,f));f.onMouseDown.add(c.hideMenu,c);return c},createColorSplitButton:function(i,s,d){var t=this,f=t.editor,g,c,h,j;if(t.get(i))return null;s.title=f.translate(s.title);s.scope=s.scope||f;if(!s.onclick){s.onclick=function(v){if(a.isIE)j=f.selection.getBookmark(1);f.execCommand(s.cmd,s.ui||false,v||s.value)}}if(!s.onselect){s.onselect=function(v){f.execCommand(s.cmd,s.ui||false,v||s.value)}}s=b({title:s.title,'class':'mce_'+i,'menu_class':f.getParam('skin')+'Skin',scope:s.scope,more_colors_title:f.getLang('more_colors')},s);i=t.prefix+i;h=d||t._cls.colorsplitbutton||a.ui.ColorSplitButton;c=new h(i,s,f);f.onMouseDown.add(c.hideMenu,c);f.onRemove.add(function(){c.destroy()});if(a.isIE){c.onShowMenu.add(function(){f.focus();j=f.selection.getBookmark(1)});c.onHideMenu.add(function(){if(j){f.selection.moveToBookmark(j);j=0}})}return t.add(c)},createToolbar:function(i,s,d){var c,t=this,f;i=t.prefix+i;f=d||t._cls.toolbar||a.ui.Toolbar;c=new f(i,s,t.editor);if(t.get(i))return null;return t.add(c)},createToolbarGroup:function(i,s,d){var c,t=this,f;i=t.prefix+i;f=d||this._cls.toolbarGroup||a.ui.ToolbarGroup;c=new f(i,s,t.editor);if(t.get(i))return null;return t.add(c)},createSeparator:function(c){var d=c||this._cls.separator||a.ui.Separator;return new d()},setControlType:function(n,c){return this._cls[n.toLowerCase()]=c},destroy:function(){e(this.controls,function(c){c.destroy()});this.controls=null}})})(tinymce);
