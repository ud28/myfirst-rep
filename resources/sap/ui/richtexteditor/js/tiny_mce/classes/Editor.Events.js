/**
 * Editor.Events.js
 *
 * Copyright, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */
(function(t){var a=t.each;t.Editor.prototype.setupEvents=function(){var s=this,b=s.settings;a(['onPreInit','onBeforeRenderUI','onPostRender','onLoad','onInit','onRemove','onActivate','onDeactivate','onClick','onEvent','onMouseUp','onMouseDown','onDblClick','onKeyDown','onKeyUp','onKeyPress','onContextMenu','onSubmit','onReset','onPaste','onPreProcess','onPostProcess','onBeforeSetContent','onBeforeGetContent','onSetContent','onGetContent','onLoadContent','onSaveContent','onNodeChange','onChange','onBeforeExecCommand','onExecCommand','onUndo','onRedo','onVisualAid','onSetProgressState','onSetAttrib'],function(n){s[n]=new t.util.Dispatcher(s)});if(b.cleanup_callback){s.onBeforeSetContent.add(function(e,o){o.content=e.execCallback('cleanup_callback','insert_to_editor',o.content,o)});s.onPreProcess.add(function(e,o){if(o.set)e.execCallback('cleanup_callback','insert_to_editor_dom',o.node,o);if(o.get)e.execCallback('cleanup_callback','get_from_editor_dom',o.node,o)});s.onPostProcess.add(function(e,o){if(o.set)o.content=e.execCallback('cleanup_callback','insert_to_editor',o.content,o);if(o.get)o.content=e.execCallback('cleanup_callback','get_from_editor',o.content,o)})}if(b.save_callback){s.onGetContent.add(function(e,o){if(o.save)o.content=e.execCallback('save_callback',e.id,o.content,e.getBody())})}if(b.handle_event_callback){s.onEvent.add(function(c,e,o){if(s.execCallback('handle_event_callback',e,c,o)===false){e.preventDefault();e.stopPropagation()}})}if(b.handle_node_change_callback){s.onNodeChange.add(function(e,c,n){e.execCallback('handle_node_change_callback',e.id,n,-1,-1,true,e.selection.isCollapsed())})}if(b.save_callback){s.onSaveContent.add(function(e,o){var h=e.execCallback('save_callback',e.id,o.content,e.getBody());if(h)o.content=h})}if(b.onchange_callback){s.onChange.add(function(e,l){e.execCallback('onchange_callback',e,l)})}};t.Editor.prototype.bindNativeEvents=function(){var s=this,i,b=s.settings,d=s.dom,n;n={mouseup:'onMouseUp',mousedown:'onMouseDown',click:'onClick',keyup:'onKeyUp',keydown:'onKeyDown',keypress:'onKeyPress',submit:'onSubmit',reset:'onReset',contextmenu:'onContextMenu',dblclick:'onDblClick',paste:'onPaste'};function c(e,j){var k=e.type;if(s.removed)return;if(s.onEvent.dispatch(s,e,j)!==false){s[n[e.fakeType||e.type]].dispatch(s,e,j)}};function f(e){s.focus(true)};function g(j,e){if(e.keyCode!=65||!t.VK.metaKeyPressed(e)){s.selection.normalize()}s.nodeChanged()}a(n,function(e,j){var r=b.content_editable?s.getBody():s.getDoc();switch(j){case'contextmenu':d.bind(r,j,c);break;case'paste':d.bind(s.getBody(),j,c);break;case'submit':case'reset':d.bind(s.getElement().form||t.DOM.getParent(s.id,'form'),j,c);break;default:d.bind(r,j,c)}});d.bind(b.content_editable?s.getBody():(t.isGecko?s.getDoc():s.getWin()),'focus',function(e){s.focus(true)});if(b.content_editable&&t.isOpera){d.bind(s.getBody(),'click',f);d.bind(s.getBody(),'keydown',f)}s.onMouseUp.add(g);s.onKeyUp.add(function(j,e){var k=e.keyCode;if((k>=33&&k<=36)||(k>=37&&k<=40)||k==13||k==45||k==46||k==8||(t.isMac&&(k==91||k==93))||e.ctrlKey)g(j,e)});s.onReset.add(function(){s.setContent(s.startContent,{format:'raw'})});function h(e,j){if(e.altKey||e.ctrlKey||e.metaKey){a(s.shortcuts,function(k){var l=t.isMac?e.metaKey:e.ctrlKey;if(k.ctrl!=l||k.alt!=e.altKey||k.shift!=e.shiftKey)return;if(e.keyCode==k.keyCode||(e.charCode&&e.charCode==k.charCode)){e.preventDefault();if(j){k.func.call(k.scope)}return true}})}};s.onKeyUp.add(function(j,e){h(e)});s.onKeyPress.add(function(j,e){h(e)});s.onKeyDown.add(function(j,e){h(e,true)});if(t.isOpera){s.onClick.add(function(j,e){e.preventDefault()})}}})(tinymce);
