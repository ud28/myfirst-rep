/**
 * Popup.js
 *
 * Copyright, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */
var tinymce=null,tinyMCEPopup,tinyMCE;tinyMCEPopup={init:function(){var t=this,w,a;w=t.getWin();tinymce=w.tinymce;tinyMCE=w.tinyMCE;t.editor=tinymce.EditorManager.activeEditor;t.params=t.editor.windowManager.params;t.features=t.editor.windowManager.features;t.dom=t.editor.windowManager.createInstance('tinymce.dom.DOMUtils',document,{ownEvents:true,proxy:tinyMCEPopup._eventProxy});t.dom.bind(window,'ready',t._onDOMLoaded,t);if(t.features.popup_css!==false)t.dom.loadCSS(t.features.popup_css||t.editor.settings.popup_css);t.listeners=[];t.onInit={add:function(f,s){t.listeners.push({func:f,scope:s})}};t.isWindow=!t.getWindowArg('mce_inline');t.id=t.getWindowArg('mce_window_id');t.editor.windowManager.onOpen.dispatch(t.editor.windowManager,window)},getWin:function(){return(!window.frameElement&&window.dialogArguments)||opener||parent||top},getWindowArg:function(n,d){var v=this.params[n];return tinymce.is(v)?v:d},getParam:function(n,d){return this.editor.getParam(n,d)},getLang:function(n,d){return this.editor.getLang(n,d)},execCommand:function(c,u,v,a){a=a||{};a.skip_focus=1;this.restoreSelection();return this.editor.execCommand(c,u,v,a)},resizeToInnerSize:function(){var t=this;setTimeout(function(){var v=t.dom.getViewPort(window);t.editor.windowManager.resizeBy(t.getWindowArg('mce_width')-v.w,t.getWindowArg('mce_height')-v.h,t.id||window)},10)},executeOnLoad:function(s){this.onInit.add(function(){eval(s)})},storeSelection:function(){this.editor.windowManager.bookmark=tinyMCEPopup.editor.selection.getBookmark(1)},restoreSelection:function(){var t=tinyMCEPopup;if(!t.isWindow&&tinymce.isIE)t.editor.selection.moveToBookmark(t.editor.windowManager.bookmark)},requireLangPack:function(){var t=this,u=t.getWindowArg('plugin_url')||t.getWindowArg('theme_url');if(u&&t.editor.settings.language&&t.features.translate_i18n!==false&&t.editor.settings.language_load!==false){u+='/langs/'+t.editor.settings.language+'_dlg.js';if(!tinymce.ScriptLoader.isDone(u)){document.write('<script type="text/javascript" src="'+tinymce._addVer(u)+'"></script>');tinymce.ScriptLoader.markDone(u)}}},pickColor:function(e,a){this.execCommand('mceColorPicker',true,{color:document.getElementById(a).value,func:function(c){document.getElementById(a).value=c;try{document.getElementById(a).onchange()}catch(b){}}})},openBrowser:function(e,t,o){tinyMCEPopup.restoreSelection();this.editor.execCallback('file_browser_callback',e,document.getElementById(e).value,t,window)},confirm:function(t,c,s){this.editor.windowManager.confirm(t,c,s,window)},alert:function(t,c,s){this.editor.windowManager.alert(t,c,s,window)},close:function(){var t=this;function c(){t.editor.windowManager.close(window);tinymce=tinyMCE=t.editor=t.params=t.dom=t.dom.doc=null};if(tinymce.isOpera)t.getWin().setTimeout(c,0);else c()},_restoreSelection:function(){var e=window.event.srcElement;if(e.nodeName=='INPUT'&&(e.type=='submit'||e.type=='button'))tinyMCEPopup.restoreSelection()},_onDOMLoaded:function(){var t=tinyMCEPopup,a=document.title,b,h,n;if(t.features.translate_i18n!==false){h=document.body.innerHTML;if(tinymce.isIE)h=h.replace(/ (value|title|alt)=([^"][^\s>]+)/gi,' $1="$2"');document.dir=t.editor.getParam('directionality','');if((n=t.editor.translate(h))&&n!=h)document.body.innerHTML=n;if((n=t.editor.translate(a))&&n!=a)document.title=a=n}if(!t.editor.getParam('browser_preferred_colors',false)||!t.isWindow)t.dom.addClass(document.body,'forceColors');document.body.style.display='';if(tinymce.isIE){document.attachEvent('onmouseup',tinyMCEPopup._restoreSelection);t.dom.add(t.dom.select('head')[0],'base',{target:'_self'})}t.restoreSelection();t.resizeToInnerSize();if(!t.isWindow)t.editor.windowManager.setTitle(window,a);else window.focus();if(!tinymce.isIE&&!t.isWindow){t.dom.bind(document,'focus',function(){t.editor.windowManager.focus(t.id)})}tinymce.each(t.dom.select('select'),function(e){e.onkeydown=tinyMCEPopup._accessHandler});tinymce.each(t.listeners,function(o){o.func.call(o.scope,t.editor)});if(t.getWindowArg('mce_auto_focus',true)){window.focus();tinymce.each(document.forms,function(f){tinymce.each(f.elements,function(e){if(t.dom.hasClass(e,'mceFocus')&&!e.disabled){e.focus();return false}})})}document.onkeyup=tinyMCEPopup._closeWinKeyHandler},_accessHandler:function(e){e=e||window.event;if(e.keyCode==13||e.keyCode==32){var a=e.target||e.srcElement;if(a.onchange)a.onchange();return tinymce.dom.Event.cancel(e)}},_closeWinKeyHandler:function(e){e=e||window.event;if(e.keyCode==27)tinyMCEPopup.close()},_eventProxy:function(i){return function(e){tinyMCEPopup.dom.events.callNativeHandler(i,e)}}};tinyMCEPopup.init();
