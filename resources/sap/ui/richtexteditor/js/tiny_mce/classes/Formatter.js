/**
 * Formatter.js
 *
 * Copyright, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */
(function(t){t.Formatter=function(a){var f={},b=t.each,d=a.dom,s=a.selection,T=t.dom.TreeWalker,r=new t.dom.RangeUtils(d),c=a.schema.isValidChild,g=t.isArray,h=d.isBlock,j=a.settings.forced_root_block,k=d.nodeIndex,I='\uFEFF',M=/^(src|href|style)$/,F=false,m=true,o,u,p=d.getContentEditable;function q(n){return!!a.schema.getTextBlocks()[n.toLowerCase()]}function v(n,e){return d.getParents(n,e,d.getRoot())};function w(n){return n.nodeType===1&&n.id==='_mce_caret'};function z(){C({alignleft:[{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li',styles:{textAlign:'left'},defaultBlock:'div'},{selector:'img,table',collapsed:false,styles:{'float':'left'}}],aligncenter:[{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li',styles:{textAlign:'center'},defaultBlock:'div'},{selector:'img',collapsed:false,styles:{display:'block',marginLeft:'auto',marginRight:'auto'}},{selector:'table',collapsed:false,styles:{marginLeft:'auto',marginRight:'auto'}}],alignright:[{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li',styles:{textAlign:'right'},defaultBlock:'div'},{selector:'img,table',collapsed:false,styles:{'float':'right'}}],alignfull:[{selector:'figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li',styles:{textAlign:'justify'},defaultBlock:'div'}],bold:[{inline:'strong',remove:'all'},{inline:'span',styles:{fontWeight:'bold'}},{inline:'b',remove:'all'}],italic:[{inline:'em',remove:'all'},{inline:'span',styles:{fontStyle:'italic'}},{inline:'i',remove:'all'}],underline:[{inline:'span',styles:{textDecoration:'underline'},exact:true},{inline:'u',remove:'all'}],strikethrough:[{inline:'span',styles:{textDecoration:'line-through'},exact:true},{inline:'strike',remove:'all'}],forecolor:{inline:'span',styles:{color:'%value'},wrap_links:false},hilitecolor:{inline:'span',styles:{backgroundColor:'%value'},wrap_links:false},fontname:{inline:'span',styles:{fontFamily:'%value'}},fontsize:{inline:'span',styles:{fontSize:'%value'}},fontsize_class:{inline:'span',attributes:{'class':'%value'}},blockquote:{block:'blockquote',wrapper:1,remove:'all'},subscript:{inline:'sub'},superscript:{inline:'sup'},link:{inline:'a',selector:'a',remove:'all',split:true,deep:true,onmatch:function(n){return true},onformat:function(e,i,l){b(l,function(n,x){d.setAttrib(e,x,n)})}},removeformat:[{selector:'b,strong,em,i,font,u,strike',remove:'all',split:true,expand:false,block_expand:true,deep:true},{selector:'span',attributes:['style','class'],remove:'empty',split:true,expand:false,deep:true},{selector:'*',attributes:['style','class'],split:false,expand:false,deep:true}]});b('p h1 h2 h3 h4 h5 h6 div address pre div code dt dd samp'.split(/\s/),function(n){C(n,{block:n,remove:'all'})});C(a.settings.formats)};function A(){a.addShortcut('ctrl+b','bold_desc','Bold');a.addShortcut('ctrl+i','italic_desc','Italic');a.addShortcut('ctrl+u','underline_desc','Underline');for(var i=1;i<=6;i++){a.addShortcut('ctrl+'+i,'',['FormatBlock',false,'h'+i])}a.addShortcut('ctrl+7','',['FormatBlock',false,'p']);a.addShortcut('ctrl+8','',['FormatBlock',false,'div']);a.addShortcut('ctrl+9','',['FormatBlock',false,'address'])};function B(n){return n?f[n]:f};function C(n,e){if(n){if(typeof(n)!=='string'){b(n,function(e,n){C(n,e)})}else{e=e.length?e:[e];b(e,function(e){if(e.deep===u)e.deep=!e.selector;if(e.split===u)e.split=!e.selector||e.inline;if(e.remove===u&&e.selector&&!e.inline)e.remove='none';if(e.selector&&e.inline){e.mixed=true;e.block_expand=true}if(typeof(e.classes)==='string')e.classes=e.classes.split(/\s+/)});f[n]=e}}};var D=function(e){var i;a.dom.getParent(e,function(n){i=a.dom.getStyle(n,'text-decoration');return i&&i!=='none'});return i};var E=function(n){var e;if(n.nodeType===1&&n.parentNode&&n.parentNode.nodeType===1){e=D(n.parentNode);if(a.dom.getStyle(n,'color')&&e){a.dom.setStyle(n,'text-decoration',e)}else if(a.dom.getStyle(n,'textdecoration')===e){a.dom.setStyle(n,'text-decoration',null)}}};function G(e,l,x){var y=B(e),e1=y[0],f1,g1,i,h1=s.isCollapsed();function i1(n,n1){n1=n1||e1;if(n){if(n1.onformat){n1.onformat(n,n1,l,x)}b(n1.styles,function(o1,e){d.setStyle(n,e,U(o1,l))});b(n1.attributes,function(o1,e){d.setAttrib(n,e,U(o1,l))});b(n1.classes,function(o1){o1=U(o1,l);if(!d.hasClass(n,o1))d.addClass(n,o1)})}};function j1(){function n(n1,o1){var r1=new T(o1);for(x=r1.current();x;x=r1.prev()){if(x.childNodes.length>1||x==n1||x.tagName=='BR'){return x}}};var g1=a.selection.getRng();var n1=g1.startContainer;var o1=g1.endContainer;if(n1!=o1&&g1.endOffset===0){var p1=n(n1,o1);var q1=p1.nodeType==3?p1.length:p1.childNodes.length;g1.setEnd(p1,q1)}return g1}function k1(x,f1,n1,o1,p1){var q1=[],r1=-1,s1,t1=-1,u1=-1,v1;b(x.childNodes,function(n,w1){if(n.nodeName==="UL"||n.nodeName==="OL"){r1=w1;s1=n;return false}});b(x.childNodes,function(n,w1){if(n.nodeName==="SPAN"&&d.getAttrib(n,"data-mce-type")=="bookmark"){if(n.id==f1.id+"_start"){t1=w1}else if(n.id==f1.id+"_end"){u1=w1}}});if(r1<=0||(t1<r1&&u1>r1)){b(t.grep(x.childNodes),p1);return 0}else{v1=d.clone(n1,F);b(t.grep(x.childNodes),function(n,w1){if((t1<r1&&w1<r1)||(t1>r1&&w1>r1)){q1.push(n);n.parentNode.removeChild(n)}});if(t1<r1){x.insertBefore(v1,s1)}else if(t1>r1){x.insertBefore(v1,s1.nextSibling)}o1.push(v1);b(q1,function(x){v1.appendChild(x)});return v1}};function l1(g1,f1,n){var n1=[],o1,p1,q1=true;o1=e1.inline||e1.block;p1=d.create(o1);i1(p1);r.walk(g1,function(r1){var s1;function t1(x){var u1,v1,w1,x1,y1;y1=q1;u1=x.nodeName.toLowerCase();v1=x.parentNode.nodeName.toLowerCase();if(x.nodeType===1&&p(x)){y1=q1;q1=p(x)==="true";x1=true}if(R(u1,'br')){s1=0;if(e1.block)d.remove(x);return}if(e1.wrapper&&K(x,e,l)){s1=0;return}if(q1&&!x1&&e1.block&&!e1.wrapper&&q(u1)){x=d.rename(x,o1);i1(x);n1.push(x);s1=0;return}if(e1.selector){b(y,function(e1){if('collapsed'in e1&&e1.collapsed!==h1){return}if(d.is(x,e1.selector)&&!w(x)){i1(x,e1);w1=true}});if(!e1.inline||w1){s1=0;return}}if(q1&&!x1&&c(o1,u1)&&c(v1,o1)&&!(!n&&x.nodeType===3&&x.nodeValue.length===1&&x.nodeValue.charCodeAt(0)===65279)&&!w(x)){if(!s1){s1=d.clone(p1,F);x.parentNode.insertBefore(s1,x);n1.push(s1)}s1.appendChild(x)}else if(u1=='li'&&f1){s1=k1(x,f1,p1,n1,t1)}else{s1=0;b(t.grep(x.childNodes),t1);if(x1){q1=y1}s1=0}};b(r1,t1)});if(e1.wrap_links===false){b(n1,function(x){function r1(x){var i,s1,t1;if(x.nodeName==='A'){s1=d.clone(p1,F);n1.push(s1);t1=t.grep(x.childNodes);for(i=0;i<t1.length;i++)s1.appendChild(t1[i]);x.appendChild(s1)}b(t.grep(x.childNodes),r1)};r1(x)})}b(n1,function(x){var r1;function s1(x){var u1=0;b(x.childNodes,function(x){if(!V(x)&&!_(x))u1++});return u1};function t1(x){var u1,v1;b(x.childNodes,function(x){if(x.nodeType==1&&!_(x)&&!w(x)){u1=x;return F}});if(u1&&Q(u1,e1)){v1=d.clone(u1,F);i1(v1);d.replace(v1,x,m);d.remove(u1,1)}return v1||x};r1=s1(x);if((n1.length>1||!h(x))&&r1===0){d.remove(x,1);return}if(e1.inline||e1.wrapper){if(!e1.exact&&r1===1)x=t1(x);b(y,function(e1){b(d.select(e1.inline,x),function(u1){var v1;if(e1.wrap_links===false){v1=u1.parentNode;do{if(v1.nodeName==='A')return}while(v1=v1.parentNode)}Y(e1,l,u1,e1.exact?u1:null)})});if(K(x.parentNode,e,l)){d.remove(x,1);x=0;return m}if(e1.merge_with_parents){d.getParent(x.parentNode,function(u1){if(K(u1,e,l)){d.remove(x,1);x=0;return m}})}if(x&&e1.merge_siblings!==false){x=a1($(x),x);x=a1(x,$(x,m))}}})};if(e1){if(x){if(x.nodeType){g1=d.createRng();g1.setStartBefore(x);g1.setEndAfter(x);l1(X(g1,y),null,true)}else{l1(x,null,true)}}else{if(!h1||!e1.inline||d.select('td.mceSelected,th.mceSelected').length){var m1=a.selection.getNode();if(!j&&y[0].defaultBlock&&!d.getParent(m1,d.isBlock)){G(y[0].defaultBlock)}a.selection.setRng(j1());f1=s.getBookmark();l1(X(s.getRng(m),y),f1);if(e1.styles&&(e1.styles.color||e1.styles.textDecoration)){t.walk(m1,E,'childNodes');E(m1)}s.moveToBookmark(f1);d1(s.getRng(m));a.nodeChanged()}else c1('apply',e,l)}}};function H(n,e,x){var y=B(n),e1=y[0],f1,i,g1,h1=true;function i1(x){var o1,i,l,p1,q1,r1;if(x.nodeType===3){return}if(x.nodeType===1&&p(x)){q1=h1;h1=p(x)==="true";r1=true}o1=t.grep(x.childNodes);if(h1&&!r1){for(i=0,l=y.length;i<l;i++){if(Y(y[i],e,x,x))break}}if(e1.deep){if(o1.length){for(i=0,l=o1.length;i<l;i++)i1(o1[i]);if(r1){h1=q1}}}};function j1(l){var o1;b(v(l.parentNode).reverse(),function(p1){var e1;if(!o1&&p1.id!='_start'&&p1.id!='_end'){e1=K(p1,n,e);if(e1&&e1.split!==false)o1=p1}});return o1};function k1(l,o1,p1,q1){var r1,s1,t1,u1,i,v1;if(l){v1=l.parentNode;for(r1=o1.parentNode;r1&&r1!=v1;r1=r1.parentNode){s1=d.clone(r1,F);for(i=0;i<y.length;i++){if(Y(y[i],e,s1,s1)){s1=0;break}}if(s1){if(t1)s1.appendChild(t1);if(!u1)u1=s1;t1=s1}}if(q1&&(!e1.mixed||!h(l)))o1=d.split(l,o1);if(t1){p1.parentNode.insertBefore(t1,p1);u1.appendChild(p1)}}return o1};function l1(l){return k1(j1(l),l,l,true)};function m1(l){var x=d.get(l?'_start':'_end'),o1=x[l?'firstChild':'lastChild'];if(_(o1))o1=o1[l?'firstChild':'lastChild'];d.remove(x,true);return o1};function n1(g1){var l,o1,x;g1=X(g1,y,m);if(e1.split){l=b1(g1,m);o1=b1(g1);if(l!=o1){if(/^(TR|TD)$/.test(l.nodeName)&&l.firstChild){l=(l.nodeName=="TD"?l.firstChild:l.firstChild.firstChild)||l}l=W(l,'span',{id:'_start','data-mce-type':'bookmark'});o1=W(o1,'span',{id:'_end','data-mce-type':'bookmark'});l1(l);l1(o1);l=m1(m);o1=m1()}else l=o1=l1(l);g1.startContainer=l.parentNode;g1.startOffset=k(l);g1.endContainer=o1.parentNode;g1.endOffset=k(o1)+1}r.walk(g1,function(p1){b(p1,function(x){i1(x);if(x.nodeType===1&&a.dom.getStyle(x,'text-decoration')==='underline'&&x.parentNode&&D(x.parentNode)==='underline'){Y({'deep':false,'exact':true,'inline':'span','styles':{'textDecoration':'underline'}},null,x)}})})};if(x){if(x.nodeType){g1=d.createRng();g1.setStartBefore(x);g1.setEndAfter(x);n1(g1)}else{n1(x)}return}if(!s.isCollapsed()||!e1.inline||d.select('td.mceSelected,th.mceSelected').length){f1=s.getBookmark();n1(s.getRng(m));s.moveToBookmark(f1);if(e1.inline&&L(n,e,s.getStart())){d1(s.getRng(true))}a.nodeChanged()}else c1('remove',n,e)};function J(n,e,i){var l=B(n);if(L(n,e,i)&&(!('toggle'in l[0])||l[0].toggle))H(n,e,i);else G(n,e,i)};function K(n,e,l,x){var y=B(e),e1,i,f1;function g1(n,e1,h1){var i1,j1,k1=e1[h1],i;if(e1.onmatch){return e1.onmatch(n,e1,h1)}if(k1){if(k1.length===u){for(i1 in k1){if(k1.hasOwnProperty(i1)){if(h1==='attributes')j1=d.getAttrib(n,i1);else j1=S(n,i1);if(x&&!j1&&!e1.exact)return;if((!x||e1.exact)&&!R(j1,U(k1[i1],l)))return}}}else{for(i=0;i<k1.length;i++){if(h1==='attributes'?d.getAttrib(n,k1[i]):S(n,k1[i]))return e1}}}return e1};if(y&&n){for(i=0;i<y.length;i++){e1=y[i];if(Q(n,e1)&&g1(n,e1,'attributes')&&g1(n,e1,'styles')){if(f1=e1.classes){for(i=0;i<f1.length;i++){if(!d.hasClass(n,f1[i]))return}}return e1}}}};function L(n,e,i){var l;function x(i){i=d.getParent(i,function(i){return!!K(i,n,e,true)});return K(i,n,e)};if(i)return x(i);i=s.getNode();if(x(i))return m;l=s.getStart();if(l!=i){if(x(l))return m}return F};function N(n,e){var l,x=[],y={},i,ni,e1;l=s.getStart();d.getParent(l,function(f1){var i,e1;for(i=0;i<n.length;i++){e1=n[i];if(!y[e1]&&K(f1,e1,e)){y[e1]=true;x.push(e1)}}},d.getRoot());return x};function O(n){var e=B(n),l,y,i,x,e1;if(e){l=s.getStart();y=v(l);for(x=e.length-1;x>=0;x--){e1=e[x].selector;if(!e1)return m;for(i=y.length-1;i>=0;i--){if(d.is(y[i],e1))return m}}}return F};function P(f,e,i){var l;if(!o){o={};l={};a.onNodeChange.addToTop(function(a,n,x){var y=v(x),e1={};b(o,function(f1,g1){b(y,function(x){if(K(x,g1,{},f1.similar)){if(!l[g1]){b(f1,function(e){e(true,{node:x,format:g1,parents:y})});l[g1]=f1}e1[g1]=f1;return false}})});b(l,function(f1,g1){if(!e1[g1]){delete l[g1];b(f1,function(e){e(false,{node:x,format:g1,parents:y})})}})})}b(f.split(','),function(n){if(!o[n]){o[n]=[];o[n].similar=i}o[n].push(e)});return this};t.extend(this,{get:B,register:C,apply:G,remove:H,toggle:J,match:L,matchAll:N,matchNode:K,canApply:O,formatChanged:P});z();A();function Q(n,e){if(R(n,e.inline))return m;if(R(n,e.block))return m;if(e.selector)return d.is(n,e.selector)};function R(e,i){e=e||'';i=i||'';e=''+(e.nodeName||e);i=''+(i.nodeName||i);return e.toLowerCase()==i.toLowerCase()};function S(n,e){var i=d.getStyle(n,e);if(e=='color'||e=='backgroundColor')i=d.toHex(i);if(e=='fontWeight'&&i==700)i='bold';return''+i};function U(e,i){if(typeof(e)!="string")e=e(i);else if(i){e=e.replace(/%(\w+)/g,function(l,n){return i[n]||l})}return e};function V(n){return n&&n.nodeType===3&&/^([\t \r\n]+|)$/.test(n.nodeValue)};function W(n,e,i){var l=d.create(e,i);n.parentNode.insertBefore(l,n);l.appendChild(n);return l};function X(e,l,H){var n,x,e1,f1,g1=e.startContainer,h1=e.startOffset,i1=e.endContainer,j1=e.endOffset;function k1(i){var y,q1,r1,n,s1,t1;y=q1=i?g1:i1;s1=i?'previousSibling':'nextSibling';t1=d.getRoot();function u1(v1){return v1.nodeName=="BR"&&v1.getAttribute('data-mce-bogus')&&!v1.nextSibling};if(y.nodeType==3&&!V(y)){if(i?h1>0:j1<y.nodeValue.length){return y}}for(;;){if(!l[0].block_expand&&h(q1))return q1;for(n=q1[s1];n;n=n[s1]){if(!_(n)&&!V(n)&&!u1(n)){return q1}}if(q1.parentNode==t1){y=q1;break}q1=q1.parentNode}return y};function l1(i,y){if(y===u)y=i.nodeType===3?i.length:i.childNodes.length;while(i&&i.hasChildNodes()){i=i.childNodes[y];if(i)y=i.nodeType===3?i.length:i.childNodes.length}return{node:i,offset:y}}if(g1.nodeType==1&&g1.hasChildNodes()){x=g1.childNodes.length-1;g1=g1.childNodes[h1>x?x:h1];if(g1.nodeType==3)h1=0}if(i1.nodeType==1&&i1.hasChildNodes()){x=i1.childNodes.length-1;i1=i1.childNodes[j1>x?x:j1-1];if(i1.nodeType==3)j1=i1.nodeValue.length}function m1(i){var y=i;while(y){if(y.nodeType===1&&p(y)){return p(y)==="false"?y:i}y=y.parentNode}return i};function n1(i,y,q1){var r1,s1,t1,u1;function v1(s1,y){var t1,w1,x1=s1.nodeValue;if(typeof(y)=="undefined"){y=q1?x1.length:0}if(q1){t1=x1.lastIndexOf(' ',y);w1=x1.lastIndexOf('\u00a0',y);t1=t1>w1?t1:w1;if(t1!==-1&&!H){t1++}}else{t1=x1.indexOf(' ',y);w1=x1.indexOf('\u00a0',y);t1=t1!==-1&&(w1===-1||t1<w1)?t1:w1}return t1};if(i.nodeType===3){t1=v1(i,y);if(t1!==-1){return{container:i,offset:t1}}u1=i}r1=new T(i,d.getParent(i,h)||a.getBody());while(s1=r1[q1?'prev':'next']()){if(s1.nodeType===3){u1=s1;t1=v1(s1);if(t1!==-1){return{container:s1,offset:t1}}}else if(h(s1)){break}}if(u1){if(q1){y=0}else{y=u1.length}return{container:u1,offset:y}}};function o1(q1,r1){var s1,i,y,t1;if(q1.nodeType==3&&q1.nodeValue.length===0&&q1[r1])q1=q1[r1];s1=v(q1);for(i=0;i<s1.length;i++){for(y=0;y<l.length;y++){t1=l[y];if("collapsed"in t1&&t1.collapsed!==e.collapsed)continue;if(d.is(s1[i],t1.selector))return s1[i]}}return q1};function p1(i,y,q1){var r1;if(!l[0].wrapper)r1=d.getParent(i,l[0].block);if(!r1)r1=d.getParent(i.nodeType==3?i.parentNode:i,q);if(r1&&l[0].wrapper)r1=v(r1,'ul,ol').reverse()[0]||r1;if(!r1){r1=i;while(r1[y]&&!h(r1[y])){r1=r1[y];if(R(r1,'br'))break}}return r1||i};g1=m1(g1);i1=m1(i1);if(_(g1.parentNode)||_(g1)){g1=_(g1)?g1:g1.parentNode;g1=g1.nextSibling||g1;if(g1.nodeType==3)h1=0}if(_(i1.parentNode)||_(i1)){i1=_(i1)?i1:i1.parentNode;i1=i1.previousSibling||i1;if(i1.nodeType==3)j1=i1.length}if(l[0].inline){if(e.collapsed){f1=n1(g1,h1,true);if(f1){g1=f1.container;h1=f1.offset}f1=n1(i1,j1);if(f1){i1=f1.container;j1=f1.offset}}e1=l1(i1,j1);if(e1.node){while(e1.node&&e1.offset===0&&e1.node.previousSibling)e1=l1(e1.node.previousSibling);if(e1.node&&e1.offset>0&&e1.node.nodeType===3&&e1.node.nodeValue.charAt(e1.offset-1)===' '){if(e1.offset>1){i1=e1.node;i1.splitText(e1.offset-1)}}}}if(l[0].inline||l[0].block_expand){if(!l[0].inline||(g1.nodeType!=3||h1===0)){g1=k1(true)}if(!l[0].inline||(i1.nodeType!=3||j1===i1.nodeValue.length)){i1=k1()}}if(l[0].selector&&l[0].expand!==F&&!l[0].inline){g1=o1(g1,'previousSibling');i1=o1(i1,'nextSibling')}if(l[0].block||l[0].selector){g1=p1(g1,'previousSibling');i1=p1(i1,'nextSibling');if(l[0].block){if(!h(g1))g1=k1(true);if(!h(i1))i1=k1()}}if(g1.nodeType==1){h1=k(g1);g1=g1.parentNode}if(i1.nodeType==1){j1=k(i1)+1;i1=i1.parentNode}return{startContainer:g1,startOffset:h1,endContainer:i1,endOffset:j1}}function Y(e,l,n,x){var i,y,e1;if(!Q(n,e))return F;if(e.remove!='all'){b(e.styles,function(f1,g1){f1=U(f1,l);if(typeof(g1)==='number'){g1=f1;x=0}if(!x||R(S(x,g1),f1))d.setStyle(n,g1,'');e1=1});if(e1&&d.getAttrib(n,'style')==''){n.removeAttribute('style');n.removeAttribute('data-mce-style')}b(e.attributes,function(f1,g1){var h1;f1=U(f1,l);if(typeof(g1)==='number'){g1=f1;x=0}if(!x||R(d.getAttrib(x,g1),f1)){if(g1=='class'){f1=d.getAttrib(n,g1);if(f1){h1='';b(f1.split(/\s+/),function(i1){if(/mce\w+/.test(i1))h1+=(h1?' ':'')+i1});if(h1){d.setAttrib(n,g1,h1);return}}}if(g1=="class")n.removeAttribute('className');if(M.test(g1))n.removeAttribute('data-mce-'+g1);n.removeAttribute(g1)}});b(e.classes,function(f1){f1=U(f1,l);if(!x||d.hasClass(x,f1))d.removeClass(n,f1)});y=d.getAttribs(n);for(i=0;i<y.length;i++){if(y[i].nodeName.indexOf('_')!==0)return F}}if(e.remove!='none'){Z(n,e);return m}};function Z(n,e){var i=n.parentNode,l;function x(n,y,e1){n=$(n,y,e1);return!n||(n.nodeName=='BR'||h(n))};if(e.block){if(!j){if(h(n)&&!h(i)){if(!x(n,F)&&!x(n.firstChild,m,1))n.insertBefore(d.create('br'),n.firstChild);if(!x(n,m)&&!x(n.lastChild,F,1))n.appendChild(d.create('br'))}}else{if(i==d.getRoot()){if(!e.list_block||!R(n,e.list_block)){b(t.grep(n.childNodes),function(n){if(c(j,n.nodeName.toLowerCase())){if(!l)l=W(n,j);else l.appendChild(n)}else l=0})}}}}if(e.selector&&e.inline&&!R(e.inline,n))return;d.remove(n,1)};function $(n,e,i){if(n){e=e?'nextSibling':'previousSibling';for(n=i?n:n[e];n;n=n[e]){if(n.nodeType==1||!V(n))return n}}};function _(n){return n&&n.nodeType==1&&n.getAttribute('data-mce-type')=='bookmark'};function a1(e,n){var i,l,x;function y(f1,g1){if(f1.nodeName!=g1.nodeName)return F;function h1(j1){var k1={};b(d.getAttribs(j1),function(l1){var m1=l1.nodeName.toLowerCase();if(m1.indexOf('_')!==0&&m1!=='style')k1[m1]=d.getAttrib(j1,m1)});return k1};function i1(j1,k1){var l1,m1;for(m1 in j1){if(j1.hasOwnProperty(m1)){l1=k1[m1];if(l1===u)return F;if(j1[m1]!=l1)return F;delete k1[m1]}}for(m1 in k1){if(k1.hasOwnProperty(m1))return F}return m};if(!i1(h1(f1),h1(g1)))return F;if(!i1(d.parseStyle(d.getAttrib(f1,'style')),d.parseStyle(d.getAttrib(g1,'style'))))return F;return m};function e1(f1,g1){for(l=f1;l;l=l[g1]){if(l.nodeType==3&&l.nodeValue.length!==0)return f1;if(l.nodeType==1&&!_(l))return l}return f1};if(e&&n){e=e1(e,'previousSibling');n=e1(n,'nextSibling');if(y(e,n)){for(l=e.nextSibling;l&&l!=n;){x=l;l=l.nextSibling;e.appendChild(x)}d.remove(n);b(t.grep(n.childNodes),function(f1){e.appendChild(f1)});return e}}return n};function q(n){return/^(h[1-6]|p|div|pre|address|dl|dt|dd)$/.test(n)};function b1(e,i){var l,n,x,y;l=e[i?'startContainer':'endContainer'];n=e[i?'startOffset':'endOffset'];if(l.nodeType==1){x=l.childNodes.length-1;if(!i&&n)n--;l=l.childNodes[n>x?x:n]}if(l.nodeType===3&&i&&n>=l.nodeValue.length){l=new T(l,a.getBody()).next()||l}if(l.nodeType===3&&!i&&n===0){l=new T(l,a.getBody()).prev()||l}return l};function c1(l,n,x){var y='_mce_caret',e1=a.settings.caret_debug;function f1(e){var i=d.create('span',{id:y,'data-mce-bogus':true,style:e1?'color:red':''});if(e){i.appendChild(a.getDoc().createTextNode(I))}return i};function g1(e,i){while(e){if((e.nodeType===3&&e.nodeValue!==I)||e.childNodes.length>1){return false}if(i&&e.nodeType===1){i.push(e)}e=e.firstChild}return true};function h1(e){while(e){if(e.id===y){return e}e=e.parentNode}};function i1(e){var i;if(e){i=new T(e,e);for(e=i.current();e;e=i.next()){if(e.nodeType===3){return e}}}};function j1(e,i){var n1,o1;if(!e){e=h1(s.getStart());if(!e){while(e=d.get(y)){j1(e,false)}}}else{o1=s.getRng(true);if(g1(e)){if(i!==false){o1.setStartBefore(e);o1.setEndBefore(e)}d.remove(e)}else{n1=i1(e);if(n1.nodeValue.charAt(0)===I){n1=n1.deleteData(0,1)}d.remove(e,1)}s.setRng(o1)}};function k1(){var e,i,n1,o1,p1,q1,r1;e=s.getRng(true);o1=e.startOffset;q1=e.startContainer;r1=q1.nodeValue;i=h1(s.getStart());if(i){n1=i1(i)}if(r1&&o1>0&&o1<r1.length&&/\w/.test(r1.charAt(o1))&&/\w/.test(r1.charAt(o1-1))){p1=s.getBookmark();e.collapse(true);e=X(e,B(n));e=r.split(e);G(n,x,e);s.moveToBookmark(p1)}else{if(!i||n1.nodeValue!==I){i=f1(true);n1=i.firstChild;e.insertNode(i);o1=1;G(n,x,i)}else{G(n,x,i)}s.setCursorLocation(n1,o1)}};function l1(){var e=s.getRng(true),n1,o1,p1,q1,r1,s1,t1=[],i,u1;n1=e.startContainer;o1=e.startOffset;r1=n1;if(n1.nodeType==3){if(o1!=n1.nodeValue.length||n1.nodeValue===I){q1=true}r1=r1.parentNode}while(r1){if(K(r1,n,x)){s1=r1;break}if(r1.nextSibling){q1=true}t1.push(r1);r1=r1.parentNode}if(!s1){return}if(q1){p1=s.getBookmark();e.collapse(true);e=X(e,B(n),true);e=r.split(e);H(n,x,e);s.moveToBookmark(p1)}else{u1=f1();r1=u1;for(i=t1.length-1;i>=0;i--){r1.appendChild(d.clone(t1[i],false));r1=r1.firstChild}r1.appendChild(d.doc.createTextNode(I));r1=r1.firstChild;d.insertAfter(u1,s1);s.setCursorLocation(r1,1)}};function m1(){var i,e,n1;e=h1(s.getStart());if(e&&!d.isEmpty(e)){t.walk(e,function(n1){if(n1.nodeType==1&&n1.id!==y&&!d.isEmpty(n1)){d.setAttrib(n1,'data-mce-bogus',null)}},'childNodes')}};if(!self._hasCaretEvents){a.onBeforeGetContent.addToTop(function(){var e=[],i;if(g1(h1(s.getStart()),e)){i=e.length;while(i--){d.setAttrib(e[i],'data-mce-bogus','1')}}});t.each('onMouseUp onKeyUp'.split(' '),function(n){a[n].addToTop(function(){j1();m1()})});a.onKeyDown.addToTop(function(a,e){var i=e.keyCode;if(i==8||i==37||i==39){j1(h1(s.getStart()))}m1()});s.onSetContent.add(m1);self._hasCaretEvents=true}if(l=="apply"){k1()}else{l1()}};function d1(e){var i=e.startContainer,l=e.startOffset,n,x,y,e1,f1;if(i.nodeType==3&&l>=i.nodeValue.length){l=k(i);i=i.parentNode;n=true}if(i.nodeType==1){e1=i.childNodes;i=e1[Math.min(l,e1.length-1)];x=new T(i,d.getParent(i,d.isBlock));if(l>e1.length-1||n)x.next();for(y=x.current();y;y=x.next()){if(y.nodeType==3&&!V(y)){f1=d.create('a',null,I);y.parentNode.insertBefore(f1,y);e.setStart(y,0);s.setRng(e);d.remove(f1);return}}}}}})(tinymce);
