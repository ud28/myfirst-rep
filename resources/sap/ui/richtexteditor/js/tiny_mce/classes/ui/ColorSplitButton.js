/**
 * ColorSplitButton.js
 *
 * Copyright, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */
(function(a){var D=a.DOM,E=a.dom.Event,b=a.is,d=a.each;a.create('tinymce.ui.ColorSplitButton:tinymce.ui.SplitButton',{ColorSplitButton:function(i,s,e){var t=this;t.parent(i,s,e);t.settings=s=a.extend({colors:'000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,999999,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,00CCFF,993366,C0C0C0,FF99CC,FFCC99,FFFF99,CCFFCC,CCFFFF,99CCFF,CC99FF,FFFFFF',grid_width:8,default_color:'#888888'},t.settings);t.onShowMenu=new a.util.Dispatcher(t);t.onHideMenu=new a.util.Dispatcher(t);t.value=s.default_color},showMenu:function(){var t=this,r,p,e,c;if(t.isDisabled())return;if(!t.isMenuRendered){t.renderMenu();t.isMenuRendered=true}if(t.isMenuVisible)return t.hideMenu();e=D.get(t.id);D.show(t.id+'_menu');D.addClass(e,'mceSplitButtonSelected');c=D.getPos(e);D.setStyles(t.id+'_menu',{left:c.x,top:c.y+e.firstChild.clientHeight,zIndex:200000});e=0;E.add(D.doc,'mousedown',t.hideMenu,t);t.onShowMenu.dispatch(t);if(t._focused){t._keyHandler=E.add(t.id+'_menu','keydown',function(e){if(e.keyCode==27)t.hideMenu()});D.select('a',t.id+'_menu')[0].focus()}t.keyboardNav=new a.ui.KeyboardNavigation({root:t.id+'_menu',items:D.select('a',t.id+'_menu'),onCancel:function(){t.hideMenu();t.focus()}});t.keyboardNav.focus();t.isMenuVisible=1},hideMenu:function(e){var t=this;if(t.isMenuVisible){if(e&&e.type=="mousedown"&&D.getParent(e.target,function(e){return e.id===t.id+'_open'}))return;if(!e||!D.getParent(e.target,'.mceSplitButtonMenu')){D.removeClass(t.id,'mceSplitButtonSelected');E.remove(D.doc,'mousedown',t.hideMenu,t);E.remove(t.id+'_menu','keydown',t._keyHandler);D.hide(t.id+'_menu')}t.isMenuVisible=0;t.onHideMenu.dispatch();t.keyboardNav.destroy()}},renderMenu:function(){var t=this,m,i=0,s=t.settings,n,f,g,w,h;w=D.add(s.menu_container,'div',{role:'listbox',id:t.id+'_menu','class':s.menu_class+' '+s['class'],style:'position:absolute;left:0;top:-1000px;'});m=D.add(w,'div',{'class':s['class']+' mceSplitButtonMenu'});D.add(m,'span',{'class':'mceMenuLine'});n=D.add(m,'table',{role:'presentation','class':'mceColorSplitMenu'});f=D.add(n,'tbody');i=0;d(b(s.colors,'array')?s.colors:s.colors.split(','),function(c){c=c.replace(/^#/,'');if(!i--){g=D.add(f,'tr');i=s.grid_width-1}n=D.add(g,'td');var e={href:'javascript:;',style:{backgroundColor:'#'+c},'title':t.editor.getLang('colors.'+c,c),'data-mce-color':'#'+c};if(!a.isIE){e.role='option'}n=D.add(n,'a',e);if(t.editor.forcedHighContrastMode){n=D.add(n,'canvas',{width:16,height:16,'aria-hidden':'true'});if(n.getContext&&(h=n.getContext("2d"))){h.fillStyle='#'+c;h.fillRect(0,0,16,16)}else{D.remove(n)}}});if(s.more_colors_func){n=D.add(f,'tr');n=D.add(n,'td',{colspan:s.grid_width,'class':'mceMoreColors'});n=D.add(n,'a',{role:'option',id:t.id+'_more',href:'javascript:;',onclick:'return false;','class':'mceMoreColors'},s.more_colors_title);E.add(n,'click',function(e){s.more_colors_func.call(s.more_colors_scope||this);return E.cancel(e)})}D.addClass(m,'mceColorSplitMenu');E.add(t.id+'_menu','mousedown',function(e){return E.cancel(e)});E.add(t.id+'_menu','click',function(e){var c;e=D.getParent(e.target,'a',f);if(e&&e.nodeName.toLowerCase()=='a'&&(c=e.getAttribute('data-mce-color')))t.setColor(c);return false});return w},setColor:function(c){this.displayColor(c);this.hideMenu();this.settings.onselect(c)},displayColor:function(c){var t=this;D.setStyle(t.id+'_preview','backgroundColor',c);t.value=c},postRender:function(){var t=this,i=t.id;t.parent();D.add(i+'_action','div',{id:i+'_preview','class':'mceColorPreview'});D.setStyle(t.id+'_preview','backgroundColor',t.value)},destroy:function(){var s=this;s.parent();E.clear(s.id+'_menu');E.clear(s.id+'_more');D.remove(s.id+'_menu');if(s.keyboardNav){s.keyboardNav.destroy()}}})})(tinymce);
