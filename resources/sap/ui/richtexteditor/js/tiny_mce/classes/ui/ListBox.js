/**
 * ListBox.js
 *
 * Copyright, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */
(function(a){var D=a.DOM,E=a.dom.Event,b=a.each,c=a.util.Dispatcher,u;a.create('tinymce.ui.ListBox:tinymce.ui.Control',{ListBox:function(i,s,e){var t=this;t.parent(i,s,e);t.items=[];t.onChange=new c(t);t.onPostRender=new c(t);t.onAdd=new c(t);t.onRenderMenu=new a.util.Dispatcher(this);t.classPrefix='mceListBox';t.marked={}},select:function(d){var t=this,e,f;t.marked={};if(d==u)return t.selectByIndex(-1);if(d&&typeof(d)=="function")f=d;else{f=function(v){return v==d}}if(d!=t.selectedValue){b(t.items,function(o,i){if(f(o.value)){e=1;t.selectByIndex(i);return false}});if(!e)t.selectByIndex(-1)}},selectByIndex:function(i){var t=this,e,o,l;t.marked={};if(i!=t.selectedIndex){e=D.get(t.id+'_text');l=D.get(t.id+'_voiceDesc');o=t.items[i];if(o){t.selectedValue=o.value;t.selectedIndex=i;D.setHTML(e,D.encode(o.title));D.setHTML(l,t.settings.title+" - "+o.title);D.removeClass(e,'mceTitle');D.setAttrib(t.id,'aria-valuenow',o.title)}else{D.setHTML(e,D.encode(t.settings.title));D.setHTML(l,D.encode(t.settings.title));D.addClass(e,'mceTitle');t.selectedValue=t.selectedIndex=null;D.setAttrib(t.id,'aria-valuenow',t.settings.title)}e=0}},mark:function(v){this.marked[v]=true},add:function(n,v,o){var t=this;o=o||{};o=a.extend(o,{title:n,value:v});t.items.push(o);t.onAdd.dispatch(t,o)},getLength:function(){return this.items.length},renderHTML:function(){var h='',t=this,s=t.settings,d=t.classPrefix;h='<span role="listbox" aria-haspopup="true" aria-labelledby="'+t.id+'_voiceDesc" aria-describedby="'+t.id+'_voiceDesc"><table role="presentation" tabindex="0" id="'+t.id+'" cellpadding="0" cellspacing="0" class="'+d+' '+d+'Enabled'+(s['class']?(' '+s['class']):'')+'"><tbody><tr>';h+='<td>'+D.createHTML('span',{id:t.id+'_voiceDesc','class':'voiceLabel',style:'display:none;'},t.settings.title);h+=D.createHTML('a',{id:t.id+'_text',tabindex:-1,href:'javascript:;','class':'mceText',onclick:"return false;",onmousedown:'return false;'},D.encode(t.settings.title))+'</td>';h+='<td>'+D.createHTML('a',{id:t.id+'_open',tabindex:-1,href:'javascript:;','class':'mceOpen',onclick:"return false;",onmousedown:'return false;'},'<span><span style="display:none;" class="mceIconOnly" aria-hidden="true">\u25BC</span></span>')+'</td>';h+='</tr></tbody></table></span>';return h},showMenu:function(){var t=this,p,e=D.get(this.id),m;if(t.isDisabled()||t.items.length===0)return;if(t.menu&&t.menu.isMenuVisible)return t.hideMenu();if(!t.isMenuRendered){t.renderMenu();t.isMenuRendered=true}p=D.getPos(e);m=t.menu;m.settings.offset_x=p.x;m.settings.offset_y=p.y;m.settings.keyboard_focus=!a.isOpera;b(t.items,function(o){if(m.items[o.id]){m.items[o.id].setSelected(0)}});b(t.items,function(o){if(m.items[o.id]&&t.marked[o.value]){m.items[o.id].setSelected(1)}if(o.value===t.selectedValue){m.items[o.id].setSelected(1)}});m.showMenu(0,e.clientHeight);E.add(D.doc,'mousedown',t.hideMenu,t);D.addClass(t.id,t.classPrefix+'Selected')},hideMenu:function(e){var t=this;if(t.menu&&t.menu.isMenuVisible){D.removeClass(t.id,t.classPrefix+'Selected');if(e&&e.type=="mousedown"&&(e.target.id==t.id+'_text'||e.target.id==t.id+'_open'))return;if(!e||!D.getParent(e.target,'.mceMenu')){D.removeClass(t.id,t.classPrefix+'Selected');E.remove(D.doc,'mousedown',t.hideMenu,t);t.menu.hideMenu()}}},renderMenu:function(){var t=this,m;m=t.settings.control_manager.createDropMenu(t.id+'_menu',{menu_line:1,'class':t.classPrefix+'Menu mceNoIcons',max_width:250,max_height:150});m.onHideMenu.add(function(){t.hideMenu();t.focus()});m.add({title:t.settings.title,'class':'mceMenuItemTitle',onclick:function(){if(t.settings.onselect('')!==false)t.select('')}});b(t.items,function(o){if(o.value===u){m.add({title:o.title,role:"option",'class':'mceMenuItemTitle',onclick:function(){if(t.settings.onselect('')!==false)t.select('')}})}else{o.id=D.uniqueId();o.role="option";o.onclick=function(){if(t.settings.onselect(o.value)!==false)t.select(o.value)};m.add(o)}});t.onRenderMenu.dispatch(t,m);t.menu=m},postRender:function(){var t=this,d=t.classPrefix;E.add(t.id,'click',t.showMenu,t);E.add(t.id,'keydown',function(e){if(e.keyCode==32){t.showMenu(e);E.cancel(e)}});E.add(t.id,'focus',function(){if(!t._focused){t.keyDownHandler=E.add(t.id,'keydown',function(e){if(e.keyCode==40){t.showMenu();E.cancel(e)}});t.keyPressHandler=E.add(t.id,'keypress',function(e){var v;if(e.keyCode==13){v=t.selectedValue;t.selectedValue=null;E.cancel(e);t.settings.onselect(v)}})}t._focused=1});E.add(t.id,'blur',function(){E.remove(t.id,'keydown',t.keyDownHandler);E.remove(t.id,'keypress',t.keyPressHandler);t._focused=0});if(a.isIE6||!D.boxModel){E.add(t.id,'mouseover',function(){if(!D.hasClass(t.id,d+'Disabled'))D.addClass(t.id,d+'Hover')});E.add(t.id,'mouseout',function(){if(!D.hasClass(t.id,d+'Disabled'))D.removeClass(t.id,d+'Hover')})}t.onPostRender.dispatch(t,D.get(t.id))},destroy:function(){this.parent();E.clear(this.id+'_text');E.clear(this.id+'_open')}})})(tinymce);
