/**
 * Quirks.js
 *
 * Copyright, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */
tinymce.util.Quirks=
function(a){var V=tinymce.VK,B=V.BACKSPACE,D=V.DELETE,d=a.dom,s=a.selection,b=a.settings,p=a.parser,c=a.serializer,f=tinymce.each;function g(e,i){try{a.getDoc().execCommand(e,false,i)}catch(j){}}function h(){var e=a.getDoc().documentMode;return e?e:6};function k(e){return e.isDefaultPrevented()};function l(){function i(e){var j,o,N,O;j=s.getRng();o=d.getParent(j.startContainer,d.isBlock);if(e){o=d.getNext(o,d.isBlock)}if(o){N=o.firstChild;while(N&&N.nodeType==3&&N.nodeValue.length===0){N=N.nextSibling}if(N&&N.nodeName==='SPAN'){O=N.cloneNode(false)}}f(d.select('span',o),function(P){P.setAttribute('data-mce-mark','1')});a.getDoc().execCommand(e?'ForwardDelete':'Delete',false,null);o=d.getParent(j.startContainer,d.isBlock);f(d.select('span',o),function(P){var Q=s.getBookmark();if(O){d.replace(O.cloneNode(false),P,true)}else if(!P.getAttribute('data-mce-mark')){d.remove(P,true)}else{P.removeAttribute('data-mce-mark')}s.moveToBookmark(Q)})}a.onKeyDown.add(function(a,e){var j;j=e.keyCode==D;if(!k(e)&&(j||e.keyCode==B)&&!V.modifierPressed(e)){e.preventDefault();i(j)}});a.addCommand('Delete',function(){i()})};function m(){function i(e){var o=d.create("body");var N=e.cloneContents();o.appendChild(N);return s.serializer.serialize(o,{format:'html'})}function j(e){var s=i(e);var o=d.createRng();o.selectNode(a.getBody());var N=i(o);return s===N}a.onKeyDown.add(function(a,e){var o=e.keyCode,N;if(!k(e)&&(o==D||o==B)){N=a.selection.isCollapsed();if(N&&!d.isEmpty(a.getBody())){return}if(tinymce.isIE&&!N){return}if(!N&&!j(a.selection.getRng())){return}a.setContent('');a.selection.setCursorLocation(a.getBody(),0);a.nodeChanged()}})};function n(){a.onKeyDown.add(function(a,e){if(!k(e)&&e.keyCode==65&&V.metaKeyPressed(e)){e.preventDefault();a.execCommand('SelectAll')}})};function q(){if(!a.settings.content_editable){d.bind(a.getDoc(),'focusin',function(e){s.setRng(s.getRng())});d.bind(a.getDoc(),'mousedown',function(e){if(e.target==a.getDoc().documentElement){a.getWin().focus();s.setRng(s.getRng())}})}};function r(){a.onKeyDown.add(function(a,e){if(!k(e)&&e.keyCode===B){if(s.isCollapsed()&&s.getRng(true).startOffset===0){var i=s.getNode();var j=i.previousSibling;if(j&&j.nodeName&&j.nodeName.toLowerCase()==="hr"){d.remove(j);tinymce.dom.Event.cancel(e)}}}})}function t(){if(!Range.prototype.getClientRects){a.onMouseDown.add(function(a,e){if(!k(e)&&e.target.nodeName==="HTML"){var i=a.getBody();i.blur();setTimeout(function(){i.focus()},0)}})}};function u(){a.onClick.add(function(a,e){e=e.target;if(/^(IMG|HR)$/.test(e.nodeName)){s.getSel().setBaseAndExtent(e,0,e,1)}if(e.nodeName=='A'&&d.hasClass(e,'mceItemAnchor')){s.select(e)}a.nodeChanged()})};function v(){function i(){var e=d.getAttribs(s.getStart().cloneNode(false));return function(){var N=s.getStart();if(N!==a.getBody()){d.setAttrib(N,"style",null);f(e,function(O){N.setAttributeNode(O.cloneNode(true))})}}}function j(){return!s.isCollapsed()&&d.getParent(s.getStart(),d.isBlock)!=d.getParent(s.getEnd(),d.isBlock)}function o(a,e){e.preventDefault();return false}a.onKeyPress.add(function(a,e){var N;if(!k(e)&&(e.keyCode==8||e.keyCode==46)&&j()){N=i();a.getDoc().execCommand('delete',false,null);N();e.preventDefault();return false}});d.bind(a.getDoc(),'cut',function(e){var N;if(!k(e)&&j()){N=i();a.onKeyUp.addToTop(o);setTimeout(function(){N();a.onKeyUp.remove(o)},0)}})}function w(){var e,i;d.bind(a.getDoc(),'selectionchange',function(){if(i){clearTimeout(i);i=0}i=window.setTimeout(function(){var j=s.getRng();if(!e||!tinymce.dom.RangeUtils.compareRanges(j,e)){a.nodeChanged();e=j}},50)})}function x(){document.body.setAttribute("role","application")}function y(){a.onKeyDown.add(function(a,e){if(!k(e)&&e.keyCode===B){if(s.isCollapsed()&&s.getRng(true).startOffset===0){var i=s.getNode().previousSibling;if(i&&i.nodeName&&i.nodeName.toLowerCase()==="table"){return tinymce.dom.Event.cancel(e)}}}})}function z(){if(h()>7){return}g('RespectVisibilityInDesign',true);a.contentStyles.push('.mceHideBrInPre pre br {display: none}');d.addClass(a.getBody(),'mceHideBrInPre');p.addNodeFilter('pre',function(e,o){var i=e.length,N,j,O,P;while(i--){N=e[i].getAll('br');j=N.length;while(j--){O=N[j];P=O.prev;if(P&&P.type===3&&P.value.charAt(P.value-1)!='\n'){P.value+='\n'}else{O.parent.insert(new tinymce.html.Node('#text',3),O,true).value='\n'}}}});c.addNodeFilter('pre',function(e,o){var i=e.length,N,j,O,P;while(i--){N=e[i].getAll('br');j=N.length;while(j--){O=N[j];P=O.prev;if(P&&P.type==3){P.value=P.value.replace(/\r?\n$/,'')}}}})}function A(){d.bind(a.getBody(),'mouseup',function(e){var i,j=s.getNode();if(j.nodeName=='IMG'){if(i=d.getStyle(j,'width')){d.setAttrib(j,'width',i.replace(/[^0-9%]+/g,''));d.setStyle(j,'width','')}if(i=d.getStyle(j,'height')){d.setAttrib(j,'height',i.replace(/[^0-9%]+/g,''));d.setStyle(j,'height','')}}})}function C(){a.onKeyDown.add(function(a,e){var i,j,o,N,O,P,Q;i=e.keyCode==D;if(!k(e)&&(i||e.keyCode==B)&&!V.modifierPressed(e)){j=s.getRng();o=j.startContainer;N=j.startOffset;Q=j.collapsed;if(o.nodeType==3&&o.nodeValue.length>0&&((N===0&&!Q)||(Q&&N===(i?0:1)))){nonEmptyElements=a.schema.getNonEmptyElements();e.preventDefault();O=d.create('br',{id:'__tmp'});o.parentNode.insertBefore(O,o);a.getDoc().execCommand(i?'ForwardDelete':'Delete',false,null);o=s.getRng().startContainer;P=o.previousSibling;if(P&&P.nodeType==1&&!d.isBlock(P)&&d.isEmpty(P)&&!nonEmptyElements[P.nodeName.toLowerCase()]){d.remove(P)}d.remove('__tmp')}}})}function E(){a.onKeyDown.add(function(a,e){var i,j,o,N,O;if(k(e)||e.keyCode!=V.BACKSPACE){return}i=s.getRng();j=i.startContainer;o=i.startOffset;N=d.getRoot();O=j;if(!i.collapsed||o!==0){return}while(O&&O.parentNode&&O.parentNode.firstChild==O&&O.parentNode!=N){O=O.parentNode}if(O.tagName==='BLOCKQUOTE'){a.formatter.toggle('blockquote',null,O);i=d.createRng();i.setStart(j,0);i.setEnd(j,0);s.setRng(i)}})};function F(){function e(){a._refreshContentEditable();g("StyleWithCSS",false);g("enableInlineTableEditing",false);if(!b.object_resizing){g("enableObjectResizing",false)}};if(!b.readonly){a.onBeforeExecCommand.add(e);a.onMouseDown.add(e)}};function G(){function e(a,o){f(d.select('a'),function(i){var j=i.parentNode,N=d.getRoot();if(j.lastChild===i){while(j&&!d.isBlock(j)){if(j.parentNode.lastChild!==j||j===N){return}j=j.parentNode}d.add(j,'br',{'data-mce-bogus':1})}})};a.onExecCommand.add(function(a,i){if(i==='CreateLink'){e(a)}});a.onSetContent.add(s.onSetContent.add(e))};function H(){if(b.forced_root_block){a.onInit.add(function(){g('DefaultParagraphSeparator',b.forced_root_block)})}}function I(){function e(i,j){if(!i||!j.initial){a.execCommand('mceRepaint')}};a.onUndo.add(e);a.onRedo.add(e);a.onSetContent.add(e)};function J(){a.onKeyDown.add(function(a,e){var i;if(!k(e)&&e.keyCode==B){i=a.getDoc().selection.createRange();if(i&&i.item){e.preventDefault();a.undoManager.beforeChange();d.remove(i.item(0));a.undoManager.add()}}})};function K(){var e;if(h()>=10){e='';f('p div h1 h2 h3 h4 h5 h6'.split(' '),function(j,i){e+=(i>0?',':'')+j+':empty'});a.contentStyles.push(e+'{padding-right: 1px !important}')}};function L(){var j,o,N,O,P,Q,R,S,T,U,W,X,Y,Z=document,$=a.getDoc();if(!b.object_resizing||b.webkit_fake_resize===false){return}g("enableObjectResizing",false);W={n:[.5,0,0,-1],e:[1,.5,1,0],s:[.5,1,0,1],w:[0,.5,-1,0],nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};function _(e){var i,e1;i=e.screenX-Q;e1=e.screenY-R;X=i*P[2]+S;Y=e1*P[3]+T;X=X<5?5:X;Y=Y<5?5:Y;if(V.modifierPressed(e)||(N.nodeName=="IMG"&&P[2]*P[3]!==0)){X=Math.round(Y/U);Y=Math.round(X*U)}d.setStyles(O,{width:X,height:Y});if(P[2]<0&&O.clientWidth<=X){d.setStyle(O,'left',j+(S-X))}if(P[3]<0&&O.clientHeight<=Y){d.setStyle(O,'top',o+(T-Y))}}function a1(){function e(i,e1){if(e1){if(N.style[i]||!a.schema.isValid(N.nodeName.toLowerCase(),i)){d.setStyle(N,i,e1)}else{d.setAttrib(N,i,e1)}}}e('width',X);e('height',Y);d.unbind($,'mousemove',_);d.unbind($,'mouseup',a1);if(Z!=$){d.unbind(Z,'mousemove',_);d.unbind(Z,'mouseup',a1)}d.remove(O);b1(N)}function b1(i){var e1,f1,g1;c1();e1=d.getPos(i);j=e1.x;o=e1.y;f1=i.offsetWidth;g1=i.offsetHeight;if(N!=i){N=i;X=Y=0}f(W,function(h1,i1){var j1;j1=d.get('mceResizeHandle'+i1);if(!j1){j1=d.add($.documentElement,'div',{id:'mceResizeHandle'+i1,'class':'mceResizeHandle',style:'cursor:'+i1+'-resize; margin:0; padding:0'});d.bind(j1,'mousedown',function(e){e.preventDefault();a1();Q=e.screenX;R=e.screenY;S=N.clientWidth;T=N.clientHeight;U=T/S;P=h1;O=N.cloneNode(true);d.addClass(O,'mceClonedResizable');d.setStyles(O,{left:j,top:o,margin:0});$.documentElement.appendChild(O);d.bind($,'mousemove',_);d.bind($,'mouseup',a1);if(Z!=$){d.bind(Z,'mousemove',_);d.bind(Z,'mouseup',a1)}})}else{d.show(j1)}d.setStyles(j1,{left:(f1*h1[0]+j)-(j1.offsetWidth/2),top:(g1*h1[1]+o)-(j1.offsetHeight/2)})});if(!tinymce.isOpera&&N.nodeName=="IMG"){N.setAttribute('data-mce-selected','1')}}function c1(){if(N){N.removeAttribute('data-mce-selected')}for(var e in W){d.hide('mceResizeHandle'+e)}}a.contentStyles.push('.mceResizeHandle {'+'position: absolute;'+'border: 1px solid black;'+'background: #FFF;'+'width: 5px;'+'height: 5px;'+'z-index: 10000'+'}'+'.mceResizeHandle:hover {'+'background: #000'+'}'+'img[data-mce-selected] {'+'outline: 1px solid black'+'}'+'img.mceClonedResizable, table.mceClonedResizable {'+'position: absolute;'+'outline: 1px dashed black;'+'opacity: .5;'+'z-index: 10000'+'}');function d1(){var e=d.getParent(s.getNode(),'table,img');f(d.select('img[data-mce-selected]'),function(i){i.removeAttribute('data-mce-selected')});if(e){b1(e)}else{c1()}}a.onNodeChange.add(d1);d.bind($,'selectionchange',d1);a.serializer.addAttributeFilter('data-mce-selected',function(e,e1){var i=e.length;while(i--){e[i].attr(e1,null)}})}function M(){if(h()<9){p.addNodeFilter('noscript',function(e){var i=e.length,j,o;while(i--){j=e[i];o=j.firstChild;if(o){j.attr('data-mce-innertext',o.value)}}});c.addNodeFilter('noscript',function(e){var i=e.length,j,o,N;while(i--){j=e[i];o=e[i].firstChild;if(o){o.value=tinymce.html.Entities.decode(o.value)}else{N=j.attributes.map['data-mce-innertext'];if(N){j.attr('data-mce-innertext',null);o=new tinymce.html.Node('#text',3);o.value=N;o.raw=true;j.append(o)}}}})}}y();E();m();if(tinymce.isWebKit){C();l();q();u();H();if(tinymce.isIDevice){w()}else{L();n()}}if(tinymce.isIE){r();x();z();A();J();K();M()}if(tinymce.isGecko){r();t();v();F();G();I()}if(tinymce.isOpera){L()}}
;
