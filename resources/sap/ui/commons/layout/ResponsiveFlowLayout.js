/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ui.commons.layout.ResponsiveFlowLayout");jQuery.sap.require("sap.ui.commons.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.ui.commons.layout.ResponsiveFlowLayout",{metadata:{library:"sap.ui.commons",properties:{"responsive":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"content":{type:"sap.ui.core.Control",multiple:true,singularName:"content"}}}});jQuery.sap.require("sap.ui.commons.layout.ResponsiveFlowLayoutData");jQuery.sap.require("sap.ui.core.IntervalTrigger");jQuery.sap.require("sap.ui.core.theming.Parameters");(function(){sap.ui.commons.layout.ResponsiveFlowLayout.INTERVAL_TRIGGER=new sap.ui.core.IntervalTrigger(300);sap.ui.commons.layout.ResponsiveFlowLayout.prototype.init=function(){this._rows=[];this._bIsRegistered=false;this._proxyComputeWidths=jQuery.proxy(b,this)};sap.ui.commons.layout.ResponsiveFlowLayout.prototype.exit=function(){delete this._rows;if(this._bIsRegistered){sap.ui.commons.layout.ResponsiveFlowLayout.INTERVAL_TRIGGER.removeListener(this._proxyComputeWidths,this);delete this._bIsRegistered}delete this._proxyComputeWidths};var u=function(t){var C=t.getContent();var r=[];var R=-1;var I={},l={};var d="";var L;var m=0,w=0,e=0;var B=false,M=false,f=false;for(var i=0;i<C.length;i++){m=sap.ui.commons.layout.ResponsiveFlowLayoutData.MIN_WIDTH;w=sap.ui.commons.layout.ResponsiveFlowLayoutData.WEIGHT;B=sap.ui.commons.layout.ResponsiveFlowLayoutData.LINEBREAK;M=sap.ui.commons.layout.ResponsiveFlowLayoutData.MARGIN;f=sap.ui.commons.layout.ResponsiveFlowLayoutData.LINEBREAKABLE;L=_(C[i]);if(L instanceof sap.ui.commons.layout.ResponsiveFlowLayoutData){B=L.getLinebreak();m=L.getMinWidth();w=L.getWeight();M=L.getMargin();f=L.getLinebreakable()}if(R<0||B){R++;r.push({height:-1,cont:[]})}e=r[R].cont.length;d=C[i].getId()+"-cont"+R+"_"+e;I={minWidth:m,weight:w,linebreakable:f,padding:M,control:C[i],id:d,breakWith:[]};var p=false;if(!!!f){for(var h=e;h>0;h--){l=r[R].cont[h-1];if(l.linebreakable){l.breakWith.push(I);p=true;break}}}if(!p){r[R].cont.push(I)}}t._rows=r};var g=function(R,$,t){var r=[];var l=10000000;var d=-1;for(var j=0;j<R.cont.length;j++){var e=jQuery.sap.byId(R.cont[j].id);if(e.length>0){var o=e[0].offsetLeft;if(l>=o){r.push({cont:[]});d++}l=o;r[d].cont.push(R.cont[j])}}return r};var a=function(R,$){var w=$.width();var r=[];var d=-1;var e=0;var t=0;var i=0;var f=0,h=0;var j=0,k=0;for(j=0;j<R.cont.length;j++){e=0;t=0;for(k=i;k<=j;k++){t=t+R.cont[k].weight}for(k=i;k<=j;k++){f=w/t*R.cont[k].weight;f=Math.floor(f);h=R.cont[k].minWidth;e+=Math.max(f,h)}if(d==-1||e>w){r.push({cont:[]});if(d!==-1){i=j}d++}r[d].cont.push(R.cont[j])}return r};var c=function(w,d){if(w.length!=d.length){return true}for(var i=0;i<w.length;i++){if(w[i].cont.length!=d[i].cont.length){return true}}return false};var s=function($,p){if(p===100){$.addClass("sapUiRFLFullLength")}else{$.removeClass("sapUiRFLFullLength")}$.css("width",p+"%")};var b=function(I){if(this.getDomRef){var d=this._rows;var e=this.getId();if(d){for(var i=0;i<d.length;i++){var $=jQuery.sap.byId(e+"-row"+i);var t=a(d[i],$);var C=g(d[i],$,this);if(I||this._bLayoutDataChanged||d[i].height!=$.height()||c(C,t)){if(this._bLayoutDataChanged){this._bLayoutDataChanged=false}var r=t;var R=0;var w=[];var j=0,k=0,z=0;var f=0;var p=0;var o,h;if(t.length>1){$.removeClass("sapUiRFLCompleteRow")}else{$.addClass("sapUiRFLCompleteRow")}for(j=0;j<r.length;j++){p=0;w.length=0;for(k=0;k<r[j].cont.length;k++){f=0;for(z=0;z<r[j].cont.length;z++){f+=r[j].cont[z].weight}o=r[j].cont[k];h=jQuery.sap.byId(o.id);p=100/f*o.weight;p=Math.floor(p);w.push(p);R+=p;s(h,p);if(o.breakWith.length>0){var l=o.weight;var m=o.minWidth;for(var n=0;n<o.breakWith.length;n++){l+=o.breakWith[n].weight;m+=o.breakWith[n].minWidth}var B=[];var q=100/l*o.weight;q=Math.floor(q);B.push(q);var v=jQuery.sap.byId(o.id+"-multi0");s(v,q);h.css("min-width",m+"px");var x=q;for(n=0;n<o.breakWith.length;n++){q=100/l*o.breakWith[n].weight;q=Math.floor(q);B.push(q);x+=q;v=jQuery.sap.byId(o.id+"-multi"+(n+1));s(v,q)}if(x<100){var y=100-x;n=0;while(y>0){v=jQuery.sap.byId(o.id+"-multi"+n);B[n]=B[n]+1;s(v,B[n]);n++;n=n>=B.length?0:n;y--}}}}if(R<100){var D=100-R;var S=D/r[j].cont.length;S=Math.ceil(S);for(var k=0;k<r[j].cont.length;k++){o=r[j].cont[k];h=jQuery.sap.byId(o.id);var W=w[k];W+=S;s(h,W);D-=S;if(D<=0){break}}}}d[i].height=$.height()}}}}else{if(this._bIsRegistered){this._bIsRegistered=false;sap.ui.commons.layout.ResponsiveFlowLayout.INTERVAL_TRIGGER.removeListener(this._proxyComputeWidths,this)}}};sap.ui.commons.layout.ResponsiveFlowLayout.prototype.onBeforeRendering=function(){u(this)};sap.ui.commons.layout.ResponsiveFlowLayout.prototype.onAfterRendering=function(e){if(this.getResponsive()){this._proxyComputeWidths(true);if(!this._bIsRegistered){this._bIsRegistered=true;sap.ui.commons.layout.ResponsiveFlowLayout.INTERVAL_TRIGGER.addListener(this._proxyComputeWidths,this)}}};sap.ui.commons.layout.ResponsiveFlowLayout.prototype.onThemeChanged=function(e){if(e.type==="LayoutDataChange"){this._bLayoutDataChanged=true}this.invalidate()};sap.ui.commons.layout.ResponsiveFlowLayout.prototype.onLayoutDataChange=sap.ui.commons.layout.ResponsiveFlowLayout.prototype.onThemeChanged;var _=function(C){var l=C.getLayoutData();if(!l){return undefined}else if(l instanceof sap.ui.commons.layout.ResponsiveFlowLayoutData){return l}else if(l.getMetadata().getName()=="sap.ui.core.VariantLayoutData"){var L=l.getMultipleLayoutData();for(var i=0;i<L.length;i++){var o=L[i];if(o instanceof sap.ui.commons.layout.ResponsiveFlowLayoutData){return o}}}}}());
