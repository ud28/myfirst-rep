/*!
 * jQuery MobiScroll v2.5.0
 * http://mobiscroll.com
 *
 * Copyright 2010-2013, Acid Media
 * Licensed under the MIT license.
 *
 */
(function($){var a={inputClass:'',invalid:[],rtl:false,group:false,groupLabel:'Groups'};$.mobiscroll.presetShort('select');$.mobiscroll.presets.select=function(b){var c=b.settings,s=$.extend({},a,c),e=$(this),m=e.prop('multiple'),f=this.id+'_dummy',o=m?(e.val()?e.val()[0]:$('option',e).attr('value')):e.val(),g=e.find('option[value="'+o+'"]').parent(),p=g.index()+'',h=p,k,l=$('label[for="'+this.id+'"]').attr('for',f),n=$('label[for="'+f+'"]'),q=s.label!==undefined?s.label:(n.length?n.text():e.attr('name')),r=[],u=[],x={},y,z,A,B,C=c.readonly,w;function D(d){return d?d.replace(/_/,''):''}function E(){var d,j=0,t={},w=[{}];if(s.group){if(s.rtl){j=1}$('optgroup',e).each(function(G){t['_'+G]=$(this).attr('label')});w[j]={};w[j][s.groupLabel]=t;d=g;j+=(s.rtl?-1:1)}else{d=e}w[j]={};w[j][q]={};$('option',d).each(function(){var v=$(this).attr('value');w[j][q]['_'+v]=$(this).text();if($(this).prop('disabled')){r.push(v)}});return w}function F(v,d){var j=[];if(m){var t=[],i=0;for(i in b._selectedValues){t.push(x[i]);j.push(i)}B.val(t.join(', '))}else{B.val(v);j=d?D(b.values[z]):null}if(d){k=true;e.val(j).trigger('change')}}if(s.group&&!$('optgroup',e).length){s.group=false}if(!s.invalid.length){s.invalid=r}if(s.group){if(s.rtl){y=1;z=0}else{y=0;z=1}}else{y=-1;z=0}$('#'+f).remove();B=$('<input type="text" id="'+f+'" class="'+s.inputClass+'" readonly />').insertBefore(e),$('option',e).each(function(){x[$(this).attr('value')]=$(this).text()});if(s.showOnFocus){B.focus(function(){b.show()})}var v=e.val()||[],i=0;for(i;i<v.length;i++){b._selectedValues[v[i]]=v[i]}F(x[o]);e.unbind('.dwsel').bind('change.dwsel',function(){if(!k){b.setSelectVal(m?e.val()||[]:[e.val()],true)}k=false}).hide().closest('.ui-field-contain').trigger('create');b.setSelectVal=function(d,j,t){o=d[0]||$('option',e).attr('value');if(m){b._selectedValues={};var i=0;for(i;i<d.length;i++){b._selectedValues[d[i]]=d[i]}}if(s.group){g=e.find('option[value="'+o+'"]').parent();h=g.index();b.temp=s.rtl?['_'+o,'_'+g.index()]:['_'+g.index(),'_'+o];if(h!==p){c.wheels=E();b.changeWheel([z]);p=h+''}}else{b.temp=['_'+o]}b.setValue(true,j,t);if(j){var G=m?true:o!==e.val();F(x[o],G)}};b.getSelectVal=function(t){var d=t?b.temp:b.values;return D(d[z])};return{width:50,wheels:w,headerText:false,multiple:m,anchor:B,formatResult:function(d){return x[D(d[z])]},parseValue:function(){var v=e.val()||[],i=0;if(m){b._selectedValues={};for(i;i<v.length;i++){b._selectedValues[v[i]]=v[i]}}o=m?(e.val()?e.val()[0]:$('option',e).attr('value')):e.val();g=e.find('option[value="'+o+'"]').parent();h=g.index();p=h+'';return s.group&&s.rtl?['_'+o,'_'+h]:s.group?['_'+h,'_'+o]:['_'+o]},validate:function(d,i,G){if(i===undefined&&m){var v=b._selectedValues,j=0;for(j in v){$('.dwwl'+z+' .dw-li[data-val="_'+v[j]+'"]',d).addClass('dw-msel')}}if(i===y){h=D(b.temp[y]);if(h!==p){g=e.find('optgroup').eq(h);h=g.index();o=g.find('option').eq(0).val();o=o||e.val();c.wheels=E();if(s.group){b.temp=s.rtl?['_'+o,'_'+h]:['_'+h,'_'+o];c.readonly=[s.rtl,!s.rtl];clearTimeout(A);A=setTimeout(function(){b.changeWheel([z]);c.readonly=C;p=h+''},G*1000);return false}}else{c.readonly=C}}else{o=D(b.temp[z])}var t=$('.dw-ul',d).eq(z);$.each(s.invalid,function(i,v){$('.dw-li[data-val="_'+v+'"]',t).removeClass('dw-v')})},onBeforeShow:function(d){c.wheels=E();if(s.group){b.temp=s.rtl?['_'+o,'_'+g.index()]:['_'+g.index(),'_'+o]}},onMarkupReady:function(d){$('.dwwl'+y,d).bind('mousedown touchstart',function(){clearTimeout(A)});if(m){d.addClass('dwms');$('.dwwl',d).eq(z).addClass('dwwms');u={};var i;for(i in b._selectedValues){u[i]=b._selectedValues[i]}}},onValueTap:function(d){if(m&&d.hasClass('dw-v')&&d.closest('.dw').find('.dw-ul').index(d.closest('.dw-ul'))==z){var j=D(d.attr('data-val'));if(d.hasClass('dw-msel')){delete b._selectedValues[j]}else{b._selectedValues[j]=j}d.toggleClass('dw-msel');if(s.display=='inline'){F(j,true)}return false}},onSelect:function(v){F(v,true);if(s.group){b.values=null}},onCancel:function(){if(s.group){b.values=null}if(m){b._selectedValues={};var i;for(i in u){b._selectedValues[i]=u[i]}}},onChange:function(v){if(s.display=='inline'&&!m){B.val(v);k=true;e.val(D(b.temp[z])).trigger('change')}},onClose:function(){B.blur()},methods:{setValue:function(d,j,t){return this.each(function(){var b=$(this).mobiscroll('getInst');if(b){if(b.setSelectVal){b.setSelectVal(d,j,t)}else{b.temp=d;b.setValue(true,j,t)}}})},getValue:function(t){var b=$(this).mobiscroll('getInst');if(b){return b.getSelectVal?b.getSelectVal(t):b.values}}}}}})(jQuery);
