/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.require("sap.ui.core.Core");jQuery.sap.require("sap.ui.thirdparty.URI");jQuery.sap.declare("sap.ui.core.AppCacheBuster",false);(function(){var c=sap.ui.getCore().getConfiguration();var l=c.getLanguage();var i={};var a=jQuery.ajax;var I=jQuery.sap.includeScript;var f=jQuery.sap.includeStyleSheet;var v=sap.ui.base.ManagedObject.prototype.validateProperty;var L=document.location.href.replace(/\?.*|#.*/g,"");var b=URI("./").absoluteTo(L);var A=b.toString();var u=URI(jQuery.sap.getModulePath("","/../"));var o=u.toString();if(u.is("relative")){u=u.absoluteTo(L)}var B=u.normalize().toString();var r=URI("resources").absoluteTo(B).toString();var F=new RegExp("^"+jQuery.sap.escapeRegExp(r));sap.ui.core.AppCacheBuster={init:function(){var g=sap.ui.core.AppCacheBuster.convertURL;var n=sap.ui.core.AppCacheBuster.normalizeURL;var h=function(U){if(U&&typeof(U)==="string"){U=n(U);return!U.match(F)}return false};jQuery.ajax=function(e,j){if(e&&e.url&&h(e.url)){e.url=g(e.url)}return a.apply(this,arguments)};jQuery.sap.includeScript=function(U,s){var e=Array.prototype.slice.apply(arguments);if(h(e[0])){e[0]=g(e[0])}return I.apply(this,e)};jQuery.sap.includeStyleSheet=function(U,s){var e=Array.prototype.slice.apply(arguments);if(h(e[0])){e[0]=g(e[0])}return f.apply(this,e)};sap.ui.base.ManagedObject.prototype.validateProperty=function(p,j){var m=this.getMetadata(),P=m.getAllProperties()[p],k;if(P&&P.type==="sap.ui.core.URI"){k=Array.prototype.slice.apply(arguments);try{if(h(k[1])){k[1]=g(k[1])}}catch(e){}}return v.apply(this,k||arguments)}},exit:function(){jQuery.ajax=a;jQuery.sap.includeScript=I;jQuery.sap.includeStyleSheet=f;sap.ui.base.ManagedObject.prototype.validateProperty=v;i={}},register:function(B){jQuery.sap.log.debug("sap.ui.core.AppCacheBuster.register(\""+B+"\");");var s=sap.ui.core.AppCacheBuster.normalizeURL(B);jQuery.sap.log.debug("  --> normalized to: \""+s+"\"");if(!i[s]){var U=s+"sap-ui-cachebuster-info.json?sap-ui-language="+l;jQuery.sap.log.info("Loading AppCacheBuster index file from: \""+U+"\".");var R=jQuery.sap.sjax({url:U,dataType:"json"});if(R&&R.data){i[s]=R.data}else{jQuery.sap.log.error("Failed to load AppCacheBuster index file from: \""+U+"\".")}}},convertURL:function(U){jQuery.sap.log.debug("sap.ui.core.AppCacheBuster.convertURL(\""+U+"\");");if(i&&U){var n=sap.ui.core.AppCacheBuster.normalizeURL(U);jQuery.sap.log.debug("  --> normalized to: \""+n+"\"");if(n&&sap.ui.core.AppCacheBuster.handleURL(n)){jQuery.each(i,function(B,m){var s;if(B&&n.length>=B.length&&n.slice(0,B.length)===B){s=n.slice(B.length);if(m[s]){U=B+"~"+m[s]+"~/"+s;jQuery.sap.log.debug("  ==> return \""+U+"\";");return false}}})}}return U},normalizeURL:function(U){var u=URI(U||"./");if(u.is("relative")){u=u.absoluteTo(L)}return u.normalizeProtocol().normalizeHostname().normalizePort().normalizePath().toString()},handleURL:function(U){return true}};var C=c.getAppCacheBuster();if(C&&C.length>0){C=C.slice();var d=true;var V=String(C[0]).toLowerCase();if(C.length===1){if(V==="true"||V==="x"){var u=URI(o);C=u.is("relative")?[u.toString()]:[]}else if(V==="false"){d=false}}if(d){sap.ui.core.AppCacheBuster.init();jQuery.each(C,function(e,U){if(U.length>0&&U.slice(-1)!=="/"){U+="/"}sap.ui.core.AppCacheBuster.register(U)})}}}());
